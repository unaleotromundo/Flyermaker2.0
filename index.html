<!DOCTYPE html>
<html lang="es">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Creador de CatÃ¡logos</title>
Â  Â  <!-- Tailwind CSS CDN -->
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <!-- Inter font -->
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
Â  Â  <!-- Cropper.js CSS -->
Â  Â  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: #f3f4f6;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Custom scrollbar for better aesthetics */
Â  Â  Â  Â  ::-webkit-scrollbar {
Â  Â  Â  Â  Â  Â  width: 8px;
Â  Â  Â  Â  }
Â  Â  Â  Â  ::-webkit-scrollbar-track {
Â  Â  Â  Â  Â  Â  background: #e2e8f0;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb {
Â  Â  Â  Â  Â  Â  background: #94a3b8;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb:hover {
Â  Â  Â  Â  Â  Â  background: #64748b;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Style for the + icon on logo upload */
Â  Â  Â  Â  .logo-upload-area {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border: 2px dashed #cbd5e1;
Â  Â  Â  Â  }
Â  Â  Â  Â  .logo-upload-area::after {
Â  Â  Â  Â  Â  Â  content: '+';
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  font-size: 3rem;
Â  Â  Â  Â  Â  Â  color: #94a3b8;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  opacity: 0.7;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  }
Â  Â  Â  Â  .logo-upload-area.has-image::after {
Â  Â  Â  Â  Â  Â  content: '';
Â  Â  Â  Â  }
Â  Â  Â  Â  .logo-upload-area img {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  z-index: 5;
Â  Â  Â  Â  }
Â  Â  Â  Â  .logo-upload-area.has-image img {
Â  Â  Â  Â  Â  Â  z-index: 15;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Enhanced Catalog Preview Styles */
Â  Â  Â  Â  #catalogPreview {
Â  Â  Â  Â  Â  Â  background-color: #ffffff;
Â  Â  Â  Â  Â  Â  padding: 2.5rem; /* Increased padding */
Â  Â  Â  Â  Â  Â  border-radius: 1.5rem; /* More rounded corners */
Â  Â  Â  Â  Â  Â  box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.1), 0 6px 15px -3px rgba(0, 0, 0, 0.05); /* Stronger shadow */
Â  Â  Â  Â  Â  Â  min-height: 500px; /* Ensure enough space */
Â  Â  Â  Â  Â  Â  display: flex; /* Use flexbox for main layout */
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  #previewStoreName {
Â  Â  Â  Â  Â  Â  font-size: 3.5rem; /* Larger font for store name */
Â  Â  Â  Â  Â  Â  font-weight: 800; /* Extra bold */
Â  Â  Â  Â  Â  Â  color: #1a202c; /* Darker text */
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  Â  Â  Â  line-height: 1.1;
Â  Â  Â  Â  }

Â  Â  Â  Â  #previewSlogan {
Â  Â  Â  Â  Â  Â  font-size: 1.25rem;
Â  Â  Â  Â  Â  Â  color: #4a5568;
Â  Â  Â  Â  Â  Â  margin-top: 0.5rem;
Â  Â  Â  Â  Â  Â  font-style: italic;
Â  Â  Â  Â  }

Â  Â  Â  Â  #previewPhoneNumber,
Â  Â  Â  Â  #previewEmail,
Â  Â  Â  Â  #previewWebsite {
Â  Â  Â  Â  Â  Â  color: #4a5568; /* Slightly darker gray for contact info */
Â  Â  Â  Â  Â  Â  font-size: 0.95rem; /* Slightly larger font */
Â  Â  Â  Â  Â  Â  margin-top: 0.25rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  #previewWebsite {
Â  Â  Â  Â  Â  Â  color: #3b82f6; /* Blue for links */
Â  Â  Â  Â  }

Â  Â  Â  Â  #previewProducts {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Responsive grid */
Â  Â  Â  Â  Â  Â  gap: 2rem; /* More space between product cards */
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  margin-top: 2rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .product-card-preview {
Â  Â  Â  Â  Â  Â  background-color: #f8fafc; /* Lighter background for product cards */
Â  Â  Â  Â  Â  Â  padding: 1.5rem; /* More padding */
Â  Â  Â  Â  Â  Â  border-radius: 1rem; /* Rounded corners */
Â  Â  Â  Â  Â  Â  box-shadow: 0 5px 10px -2px rgba(0, 0, 0, 0.05), 0 2px 5px -1px rgba(0, 0, 0, 0.02); /* Subtle shadow */
Â  Â  Â  Â  Â  Â  border: 1px solid #e2e8f0; /* Light border */
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .product-card-preview img {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 200px; /* Fixed height for consistency */
Â  Â  Â  Â  Â  Â  object-contain; /* Ensure image is not distorted */
Â  Â  Â  Â  Â  Â  border-radius: 0.75rem; /* Rounded image corners */
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  Â  Â  Â  background-color: #ffffff; /* White background for images */
Â  Â  Â  Â  Â  Â  padding: 0.5rem; /* Small padding inside image container */
Â  Â  Â  Â  Â  Â  border: 1px solid #edf2f7; /* Light border for image */
Â  Â  Â  Â  }

Â  Â  Â  Â  .product-card-preview h4 {
Â  Â  Â  Â  Â  Â  font-size: 1.5rem; /* Larger product name */
Â  Â  Â  Â  Â  Â  font-weight: 700; /* Bold */
Â  Â  Â  Â  Â  Â  color: #2d3748; /* Darker text */
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .product-card-preview p:nth-of-type(1) { /* Price */
Â  Â  Â  Â  Â  Â  font-size: 1.75rem; /* Larger price */
Â  Â  Â  Â  Â  Â  font-weight: 800; /* Extra bold */
Â  Â  Â  Â  Â  Â  color: #2563eb; /* Stronger blue for price */
Â  Â  Â  Â  Â  Â  margin-bottom: 0.75rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .product-card-preview p:nth-of-type(2) { /* Description */
Â  Â  Â  Â  Â  Â  color: #4a5568; /* Darker gray for description */
Â  Â  Â  Â  Â  Â  font-size: 1rem; /* Standard font size */
Â  Â  Â  Â  Â  Â  line-height: 1.5;
Â  Â  Â  Â  }
Â  Â  Â  Â  .product-card-preview .tags {
Â  Â  Â  Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  Â  Â  Â  color: #6b7280;
Â  Â  Â  Â  Â  Â  margin-top: 0.5rem;
Â  Â  Â  Â  Â  Â  font-style: italic;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-8 px-4">

Â  Â  <!-- Main Container -->
Â  Â  <div class="bg-white rounded-xl shadow-lg p-8 max-w-4xl w-full mb-8">
Â  Â  Â  Â  <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">Crea tu CatÃ¡logo Promocional</h1>

Â  Â  Â  Â  <!-- Loading Indicator -->
Â  Â  Â  Â  <div id="loading-spinner" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
Â  Â  Â  Â  Â  Â  <div class="animate-spin rounded-full h-20 w-20 border-t-4 border-b-4 border-blue-500"></div>
Â  Â  Â  Â  Â  Â  <p class="text-white text-lg ml-4">Generando...</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Catalog Form -->
Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
Â  Â  Â  Â  Â  Â  <div class="space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-semibold text-gray-700 mb-4">Detalles de la Tienda</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="storeName" class="block text-sm font-medium text-gray-700 mb-1">Nombre de la Tienda</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="storeName" placeholder="Ej. Mi Tienda Online"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â oninput="updatePreview()">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="storeSlogan" class="block text-sm font-medium text-gray-700 mb-1">Eslogan de la Tienda</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="storeSlogan" placeholder="Ej. Tu estilo, tu esencia."
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â oninput="updatePreview()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="generateStoreSlogan()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="bg-yellow-500 text-white py-2 px-4 rounded-md hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition duration-150 ease-in-out text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Generar Eslogan âœ¨
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="logoUpload" class="block text-sm font-medium text-gray-700 mb-1">Logo de la Empresa</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="logoUpload" accept="image/*" class="hidden"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onchange="handleImageUpload(event, 'logoPreview', 'logoUploadArea')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="logoUploadArea" class="mt-2 w-24 h-24 border border-gray-300 rounded-md flex items-center justify-center overflow-hidden logo-upload-area"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onclick="document.getElementById('logoUpload').click()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="logoPreview" src="https://placehold.co/96x96/e0e7ff/4338ca?text=Logo" alt="Vista previa del logo" class="max-w-full max-h-full object-contain">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="showGenerateLogoModal()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out mt-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Generar Logo con IA âœ¨
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <!-- New Contact Info Fields -->
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="phoneNumber" class="block text-sm font-medium text-gray-700 mb-1">NÃºmero de TelÃ©fono</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" id="phoneNumber" placeholder="Ej. +598 99 123 456"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â oninput="updatePreview()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="generatePhoneNumberQR()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-150 ease-in-out text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Generar QR WhatsApp ðŸ’¬
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Correo ElectrÃ³nico</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="email" placeholder="Ej. info@mitienda.com"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â oninput="updatePreview()">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="website" class="block text-sm font-medium text-gray-700 mb-1">Sitio Web / Red Social</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="url" id="website" placeholder="Ej. www.mitienda.com o facebook.com/mitienda"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â oninput="updatePreview()">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-semibold text-gray-700 mb-4 mt-8">Productos</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="productsContainer" class="space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Product input fields will be added here dynamically -->
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="addProduct()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-150 ease-in-out">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  + AÃ±adir Producto
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <!-- Catalog Preview -->
Â  Â  Â  Â  Â  Â  <div class="bg-gray-50 rounded-lg p-6 shadow-inner border border-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-semibold text-gray-700 mb-4">Vista Previa del CatÃ¡logo</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="catalogPreview" class="bg-white p-6 rounded-lg shadow-md border border-gray-100 min-h-[400px]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Header Section -->
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col items-center justify-center mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="previewLogo" src="https://placehold.co/120x120/e0e7ff/4338ca?text=Logo" alt="Logo de la tienda" class="w-32 h-32 object-contain rounded-full border-4 border-blue-200 p-1 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 id="previewStoreName" class="text-4xl font-extrabold text-gray-900 mb-2">Nombre de la Tienda</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="previewSlogan" class="text-gray-700 text-lg mt-1"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="previewPhoneNumber" class="text-gray-700 text-base mt-1"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="previewEmail" class="text-gray-700 text-base"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a id="previewWebsite" href="#" target="_blank" class="text-blue-600 text-base hover:underline mt-1"></a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Products Grid -->
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="previewProducts" class="grid grid-cols-1 sm:grid-cols-2 gap-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Product previews will be added here -->
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Action Buttons -->
Â  Â  Â  Â  <div class="mt-8 flex flex-col sm:flex-row justify-center gap-4">
Â  Â  Â  Â  Â  Â  <button id="saveCatalogBtn"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="bg-blue-600 text-white py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out font-semibold text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Guardar CatÃ¡logo
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button id="generatePdfBtn"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="bg-red-600 text-white py-3 px-6 rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition duration-150 ease-in-out font-semibold text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Generar PDF
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button id="generateImageBtn"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="bg-purple-600 text-white py-3 px-6 rounded-lg shadow-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition duration-150 ease-in-out font-semibold text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Generar Imagen
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button type="button" onclick="summarizeCatalog()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="bg-orange-500 text-white py-3 px-6 rounded-lg shadow-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition duration-150 ease-in-out font-semibold text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Resumir CatÃ¡logo âœ¨
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Message Box -->
Â  Â  Â  Â  <div id="messageBox" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-lg p-8 shadow-xl max-w-sm w-full text-center">
Â  Â  Â  Â  Â  Â  Â  Â  <p id="messageText" class="text-lg font-semibold text-gray-800 mb-6"></p>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="hideMessageBox()" class="bg-blue-500 text-white py-2 px-6 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Aceptar
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Social Media Post Modal -->
Â  Â  Â  Â  <div id="socialMediaPostModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-lg p-8 shadow-xl max-w-lg w-full">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-semibold text-gray-800 mb-4">PublicaciÃ³n para Redes Sociales</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="socialMediaPostContent" rows="8" class="w-full p-3 border border-gray-300 rounded-md mb-4 text-gray-700" readonly></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="copySocialMediaPost()" class="bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Copiar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="hideSocialMediaPostModal()" class="bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Cerrar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- QR Code Modal -->
Â  Â  Â  Â  <div id="qrCodeModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-lg p-8 shadow-xl max-w-sm w-full text-center">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-semibold text-gray-800 mb-4">CÃ³digo QR para WhatsApp</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="qrCodeContainer" class="flex justify-center mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- QR code will be rendered here -->
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-600 text-sm mb-4">Escanea para iniciar un chat de WhatsApp con la tienda.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="copyQrCodeImage()" class="bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Copiar Imagen QR
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="downloadQrCodeImage()" class="bg-purple-500 text-white py-2 px-4 rounded-md hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Descargar Imagen QR
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="hideQrCodeModal()" class="bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Cerrar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Catalog Summary Modal -->
Â  Â  Â  Â  <div id="catalogSummaryModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-lg p-8 shadow-xl max-w-lg w-full">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-semibold text-gray-800 mb-4">Resumen del CatÃ¡logo</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="catalogSummaryContent" rows="8" class="w-full p-3 border border-gray-300 rounded-md mb-4 text-gray-700" readonly></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="copyCatalogSummary()" class="bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Copiar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="hideCatalogSummaryModal()" class="bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Cerrar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Generate Logo Modal -->
Â  Â  Â  Â  <div id="generateLogoModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-lg p-8 shadow-xl max-w-sm w-full">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-semibold text-gray-800 mb-4">Generar Logo con IA</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="logoDescription" class="block text-sm font-medium text-gray-700 mb-1">Describe el logo deseado:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="logoDescription" rows="3" placeholder="Ej. Un logo minimalista con un Ã¡rbol y colores verdes."
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="generateAILogo()" class="bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Generar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="hideGenerateLogoModal()" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Cancelar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Image Cropping Modal -->
Â  Â  Â  Â  <div id="imageCropModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-lg p-8 shadow-xl max-w-2xl w-full">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-semibold text-gray-800 mb-4">Recortar Imagen</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full h-96 flex items-center justify-center bg-gray-100 overflow-hidden mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="imageToCrop" src="" alt="Imagen a recortar" class="max-w-full max-h-full block">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="cropAndApplyImage()" class="bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Recortar y Aplicar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="cancelImageCrop()" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Cancelar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  </div>

Â  Â  <!-- Firebase SDK -->
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  Â  Â  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
Â  Â  Â  Â  import { getFirestore, doc, setDoc, collection, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";


Â  Â  Â  Â  // Global variables for Firebase
Â  Â  Â  Â  let app;
Â  Â  Â  Â  let db;
Â  Â  Â  Â  let auth;
Â  Â  Â  Â  let userId;
Â  Â  Â  Â  let isAuthReady = false;

Â  Â  Â  Â  // Cropper.js instance and related variables
Â  Â  Â  Â  let cropper;
Â  Â  Â  Â  let currentImagePreviewId;
Â  Â  Â  Â  let currentImageUploadAreaId;

Â  Â  Â  Â  // --- ConfiguraciÃ³n del backend ---
Â  Â  Â  Â  // CORRECCIÃ“N: Se cambiÃ³ la ruta relativa a la URL absoluta de Vercel.
Â  Â  Â  Â  const BACKEND_URL = 'https://tucatalogo.vercel.app/api';

Â  Â  Â  Â  // Message box functions
Â  Â  Â  Â  function showMessageBox(message) {
Â  Â  Â  Â  Â  Â  document.getElementById('messageText').innerText = message;
Â  Â  Â  Â  Â  Â  document.getElementById('messageBox').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.hideMessageBox = function() { // Expose to window for onclick
Â  Â  Â  Â  Â  Â  document.getElementById('messageBox').classList.add('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  function showSocialMediaPostModal(content) {
Â  Â  Â  Â  Â  Â  document.getElementById('socialMediaPostContent').value = content;
Â  Â  Â  Â  Â  Â  document.getElementById('socialMediaPostModal').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.hideSocialMediaPostModal = function() { // Expose to window for onclick
Â  Â  Â  Â  Â  Â  document.getElementById('socialMediaPostModal').classList.add('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.copySocialMediaPost = function() {
Â  Â  Â  Â  Â  Â  const textarea = document.getElementById('socialMediaPostContent');
Â  Â  Â  Â  Â  Â  textarea.select();
Â  Â  Â  Â  Â  Â  document.execCommand('copy');
Â  Â  Â  Â  Â  Â  showMessageBox('Â¡PublicaciÃ³n copiada al portapapeles!');
Â  Â  Â  Â  }

Â  Â  Â  Â  // QR Code Modal Functions
Â  Â  Â  Â  function showQrCodeModal() {
Â  Â  Â  Â  Â  Â  document.getElementById('qrCodeModal').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.hideQrCodeModal = function() {
Â  Â  Â  Â  Â  Â  document.getElementById('qrCodeModal').classList.add('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.copyQrCodeImage = function() {
Â  Â  Â  Â  Â  Â  const qrCanvas = document.querySelector('#qrCodeContainer canvas');
Â  Â  Â  Â  Â  Â  if (qrCanvas) {
Â  Â  Â  Â  Â  Â  Â  Â  qrCanvas.toBlob(function(blob) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const item = new ClipboardItem({ "image/png": blob });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  navigator.clipboard.write([item]).then(function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('Â¡Imagen QR copiada al portapapeles!');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, function(error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error al copiar imagen QR:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('Error al copiar imagen QR. AsegÃºrese de que su navegador lo permita.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('No se encontrÃ³ el cÃ³digo QR para copiar.');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.downloadQrCodeImage = function() {
Â  Â  Â  Â  Â  Â  const qrCanvas = document.querySelector('#qrCodeContainer canvas');
Â  Â  Â  Â  Â  Â  if (qrCanvas) {
Â  Â  Â  Â  Â  Â  Â  Â  const link = document.createElement('a');
Â  Â  Â  Â  Â  Â  Â  Â  link.href = qrCanvas.toDataURL('image/png');
Â  Â  Â  Â  Â  Â  Â  Â  link.download = 'qr_whatsapp.png'; // Changed download name
Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(link);
Â  Â  Â  Â  Â  Â  Â  Â  link.click();
Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(link);
Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('Â¡Imagen QR descargada con Ã©xito!');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('No se encontrÃ³ el cÃ³digo QR para descargar.');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Catalog Summary Modal Functions
Â  Â  Â  Â  function showCatalogSummaryModal(content) {
Â  Â  Â  Â  Â  Â  document.getElementById('catalogSummaryContent').value = content;
Â  Â  Â  Â  Â  Â  document.getElementById('catalogSummaryModal').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.hideCatalogSummaryModal = function() {
Â  Â  Â  Â  Â  Â  document.getElementById('catalogSummaryModal').classList.add('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.copyCatalogSummary = function() {
Â  Â  Â  Â  Â  Â  const textarea = document.getElementById('catalogSummaryContent');
Â  Â  Â  Â  Â  Â  textarea.select();
Â  Â  Â  Â  Â  Â  document.execCommand('copy');
Â  Â  Â  Â  Â  Â  showMessageBox('Â¡Resumen copiado al portapapeles!');
Â  Â  Â  Â  }

Â  Â  Â  Â  // Generate Logo Modal Functions
Â  Â  Â  Â  window.showGenerateLogoModal = function() {
Â  Â  Â  Â  Â  Â  document.getElementById('generateLogoModal').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.hideGenerateLogoModal = function() {
Â  Â  Â  Â  Â  Â  document.getElementById('generateLogoModal').classList.add('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  // Image Cropping Modal Functions
Â  Â  Â  Â  function showImageCropModal() {
Â  Â  Â  Â  Â  Â  document.getElementById('imageCropModal').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.hideImageCropModal = function() {
Â  Â  Â  Â  Â  Â  document.getElementById('imageCropModal').classList.add('hidden');
Â  Â  Â  Â  Â  Â  if (cropper) {
Â  Â  Â  Â  Â  Â  Â  Â  cropper.destroy(); // Destroy cropper instance when hiding modal
Â  Â  Â  Â  Â  Â  Â  Â  cropper = null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.cropAndApplyImage = function() {
Â  Â  Â  Â  Â  Â  if (cropper) {
Â  Â  Â  Â  Â  Â  Â  Â  // Get cropped image data as base64
Â  Â  Â  Â  Â  Â  Â  Â  const croppedCanvas = cropper.getCroppedCanvas({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 400, // Desired output width
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height: 400, // Desired output height (1:1 aspect ratio)
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  const croppedImageDataURL = croppedCanvas.toDataURL('image/png');

Â  Â  Â  Â  Â  Â  Â  Â  // Apply to the correct preview element
Â  Â  Â  Â  Â  Â  Â  Â  const previewElement = document.getElementById(currentImagePreviewId);
Â  Â  Â  Â  Â  Â  Â  Â  const uploadArea = currentImageUploadAreaId ? document.getElementById(currentImageUploadAreaId) : null;

Â  Â  Â  Â  Â  Â  Â  Â  if (previewElement) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewElement.src = croppedImageDataURL;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (uploadArea) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uploadArea.classList.add('has-image');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatePreview();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  hideImageCropModal();
Â  Â  Â  Â  }

Â  Â  Â  Â  window.cancelImageCrop = function() {
Â  Â  Â  Â  Â  Â  hideImageCropModal();
Â  Â  Â  Â  Â  Â  // Optionally reset the input file field if the user cancels
Â  Â  Â  Â  Â  Â  // This might be tricky if they want to re-select the same file after cancelling.
Â  Â  Â  Â  Â  Â  // For now, we just close the modal.
Â  Â  Â  Â  }


Â  Â  Â  Â  // Initialize Firebase and authenticate
Â  Â  Â  Â  window.onload = async function() {
Â  Â  Â  Â  Â  Â  // Get Firebase config and app ID from the environment
Â  Â  Â  Â  Â  Â  const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
Â  Â  Â  Â  Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
Â  Â  Â  Â  Â  Â  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

Â  Â  Â  Â  Â  Â  // En un entorno de GitHub Pages, esta configuraciÃ³n no existe.
Â  Â  Â  Â  Â  Â  if (Object.keys(firebaseConfig).length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â console.warn("Firebase config is missing. Assuming a non-Canvas environment. Save functionality will not work.");
Â  Â  Â  Â  Â  Â  Â  Â  Â // Establecer un ID de usuario anÃ³nimo para que otras funciones no rompan.
Â  Â  Â  Â  Â  Â  Â  Â  Â userId = 'github-user';
Â  Â  Â  Â  Â  Â  Â  Â  Â // AÃ±adir producto inicial y actualizar vista previa
Â  Â  Â  Â  Â  Â  Â  Â  Â addProduct();
Â  Â  Â  Â  Â  Â  Â  Â  Â updatePreview();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  app = initializeApp(firebaseConfig);
Â  Â  Â  Â  Â  Â  Â  Â  db = getFirestore(app);
Â  Â  Â  Â  Â  Â  Â  Â  auth = getAuth(app);

Â  Â  Â  Â  Â  Â  Â  Â  // Sign in using custom token or anonymously
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (initialAuthToken) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signInWithCustomToken(auth, initialAuthToken);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signInAnonymously(auth);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onAuthStateChanged(auth, (user) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = user.uid;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAuthReady = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Usuario autenticado:", userId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Add initial product field and update preview
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addProduct();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatePreview();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("No hay usuario autenticado.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox("No se pudo autenticar al usuario. Algunas funciones pueden no estar disponibles.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error de autenticaciÃ³n de Firebase:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox(`Error de autenticaciÃ³n: ${error.message}. La funciÃ³n de guardar no estarÃ¡ disponible.`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }


Â  Â  Â  Â  Â  Â  // Event listeners for buttons
Â  Â  Â  Â  Â  Â  document.getElementById('saveCatalogBtn').addEventListener('click', saveCatalog);
Â  Â  Â  Â  Â  Â  document.getElementById('generatePdfBtn').addEventListener('click', generatePDF);
Â  Â  Â  Â  Â  Â  document.getElementById('generateImageBtn').addEventListener('click', generateImage);
Â  Â  Â  Â  Â  Â  // Initial call to check logo presence for '+' icon
Â  Â  Â  Â  Â  Â  const logoPreview = document.getElementById('logoPreview');
Â  Â  Â  Â  Â  Â  const logoUploadArea = document.getElementById('logoUploadArea');
Â  Â  Â  Â  Â  Â  if (logoPreview.src && !logoPreview.src.includes('placehold.co')) {
Â  Â  Â  Â  Â  Â  Â  Â  logoUploadArea.classList.add('has-image');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  logoUploadArea.classList.remove('has-image');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // Function to handle image uploads and display previews
Â  Â  Â  Â  window.handleImageUpload = async function(event, previewId, uploadAreaId) { // Made async
Â  Â  Â  Â  Â  Â  const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgToCrop = document.getElementById('imageToCrop');
                    imgToCrop.src = e.target.result;
                    currentImagePreviewId = previewId;
                    currentImageUploadAreaId = uploadAreaId;
                    showImageCropModal();

                    setTimeout(() => {
                        if (cropper) {
                            cropper.destroy();
                        }
                        cropper = new Cropper(imgToCrop, {
                            aspectRatio: 1, // 1:1 aspect ratio for square logos/products
                            viewMode: 1, // Restrict the crop box to not exceed the canvas
                        });
                    }, 100);
                };
                reader.readAsDataURL(file);
            }
Â  Â  Â  Â  };

        // Functions for generating content
        async function generateStoreSlogan() {
            // ... (implementaciÃ³n de la funciÃ³n)
            console.log("Generando eslogan...");
        }

        async function generatePhoneNumberQR() {
            const phoneNumber = document.getElementById('phoneNumber').value;
            if (!phoneNumber) {
                showMessageBox("Por favor, ingresa un nÃºmero de telÃ©fono.");
                return;
            }
            // Elimina caracteres no numÃ©ricos excepto el '+'
            const cleanedNumber = phoneNumber.replace(/[^0-9+]/g, '');
            const whatsappUrl = `https://wa.me/${cleanedNumber}`;
            
            const qrCodeContainer = document.getElementById('qrCodeContainer');
            qrCodeContainer.innerHTML = ''; // Limpiar cualquier QR anterior
            
            new QRious({
                element: qrCodeContainer,
                value: whatsappUrl,
                size: 200,
                padding: 10
            });
            showQrCodeModal();
        }
        
        async function generateAILogo() {
            const logoDescription = document.getElementById('logoDescription').value;
            const storeName = document.getElementById('storeName').value;
            if (!logoDescription) {
                showMessageBox("Por favor, describe el logo que deseas.");
                return;
            }
            
            const fullPrompt = `${logoDescription}. Para una tienda llamada ${storeName}. El logo debe ser minimalista y moderno, sin texto.`;
            
            hideGenerateLogoModal();
            showLoadingSpinner();
            
            try {
                const response = await fetch(`${BACKEND_URL}/generate-image`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: fullPrompt }),
                });

                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }

                const result = await response.json();
                const base64Image = result?.predictions?.[0]?.bytesBase64Encoded;

                if (base64Image) {
                    const logoPreview = document.getElementById('logoPreview');
                    const imageUrl = `data:image/png;base64,${base64Image}`;
                    logoPreview.src = imageUrl;
                    document.getElementById('logoUploadArea').classList.add('has-image');
                    updatePreview();
                    showMessageBox('Â¡Logo generado con Ã©xito!');
                } else {
                    throw new Error('No se pudo generar la imagen o la respuesta no es vÃ¡lida.');
                }

            } catch (error) {
                console.error('Error al generar logo con IA:', error);
                showMessageBox(`Error al generar el logo: ${error.message}.`);
            } finally {
                hideLoadingSpinner();
            }
        }
        
        async function summarizeCatalog() {
             // ... (implementaciÃ³n de la funciÃ³n)
             console.log("Resumiendo catÃ¡logo...");
        }

        async function updatePreview() {
            // ... (implementaciÃ³n de la funciÃ³n)
            console.log("Actualizando vista previa...");
        }

        async function addProduct() {
             // ... (implementaciÃ³n de la funciÃ³n)
             console.log("AÃ±adiendo producto...");
        }

        async function saveCatalog() {
            // ... (implementaciÃ³n de la funciÃ³n)
            console.log("Guardando catÃ¡logo...");
        }
        
        async function generatePDF() {
            // ... (implementaciÃ³n de la funciÃ³n)
            console.log("Generando PDF...");
        }

        async function generateImage() {
            // ... (implementaciÃ³n de la funciÃ³n)
            console.log("Generando imagen del catÃ¡logo...");
        }
        
        function showLoadingSpinner() {
            document.getElementById('loading-spinner').classList.remove('hidden');
        }

        function hideLoadingSpinner() {
            document.getElementById('loading-spinner').classList.add('hidden');
        }

Â  Â  </script>
</body>
</html>
