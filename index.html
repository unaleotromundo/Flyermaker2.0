<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flyer Mágico Avanzado</title>

  <!-- Fuentes Google Fonts, alternativas creativas y Webdings -->
  <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Anton&family=Archivo+Black&family=Bebas+Neue&family=Lobster&family=Montserrat&family=Oswald&family=Playfair+Display&family=Poppins&family=Quicksand&family=Arizonia&family=Permanent+Marker&family=Rock+Salt&family=Fredericka+the+Great&family=Bangers&family=Covered+By+Your+Grace&family=Luckiest+Guy&family=Shadows+Into+Light&family=Orbitron:wght@900&family=Indie+Flower&family=Pacifico&family=Press+Start+2P&family=Gloria+Hallelujah&family=Rammetto+One&family=Monoton&family=Rubik+Moonrocks&family=Special+Elite&family=Amatic+SC:wght@700&family=VT323&family=Chewy&family=Black+Ops+One&family=Faster+One&family=Acme&family=Rye&family=Rubik+80s+Fade&family=Sigmar+One&family=UnifrakturCook:wght@700&family=Sacramento&family=Chango&family=Major+Mono+Display&family=IBM+Plex+Mono:wght@700&family=Poiret+One&family=Unbounded:wght@700&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.2.4/fabric.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root {
      --bg: #f4f4f4;
      --text: #111;
      --panel: #ffffff;
      --border: #ccc;
      --header-bg: #1e88e5;
      --header-text: #fff;
      --footer-bg: #262626;
      --footer-text: #fff;
    }

    body.dark {
      --bg: #121212;
      --text: #eeeeee;
      --panel: #1e1e1e;
      --border: #444;
      --header-bg: #263859;
      --header-text: #fff;
      --footer-bg: #131313;
      --footer-text: #bbb;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      gap: 20px;
      padding: 20px;
      min-height: 100vh;
      box-sizing: border-box;
      flex-direction: column;
    }

    .header-banner {
      background: var(--header-bg);
      color: var(--header-text);
      padding: 18px 20px;
      border-radius: 0 0 12px 12px;
      font-size: 1.1rem;
      font-family: "Montserrat", Arial, sans-serif;
      text-align: center;
      margin-bottom: 16px;
      box-shadow: 0 6px 20px rgba(30, 136, 229, 0.18);
      position: relative;
    }
    .header-banner strong {
      font-weight: bold;
      letter-spacing: 0.5px;
      text-shadow: 1px 1px 2px #0003;
    }
    .header-banner a {
      color: #fff;
      text-decoration: underline;
      font-weight: bold;
      margin-left: 8px;
      transition: color 0.2s;
    }
    .header-banner a:hover {
      color: #ffeb3b;
    }
    .main-content {
      display: flex;
      gap: 20px;
      flex: 1;
      width: 100%;
    }

    .panel {
      width: 340px;
      background: var(--panel);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 15px;
      border: 1px solid var(--border);
    }

    .panel label {
      font-weight: bold;
    }

    .panel input[type="text"], .panel select {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 15px;
      background: var(--bg);
      color: var(--text);
      box-sizing: border-box;
    }

    .color-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .color-square {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      border: 2px solid var(--border);
      display: inline-block;
      vertical-align: middle;
      margin-right: 0;
      margin-left: 0;
      background: #000;
    }

    #colorTexto {
      opacity: 0;
      width: 32px;
      height: 32px;
      position: absolute;
      left: 0;
      cursor: pointer;
    }

    .color-wrap {
      position: relative;
      display: inline-block;
      vertical-align: middle;
    }

    .panel button {
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #4caf50;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    .panel button:hover {
      background: #45a049;
    }

    .layer-controls {
      display: flex;
      gap: 10px;
    }

    .layer-controls button {
      flex: 1;
      background: #888;
    }

    .upload-box {
      height: 60px;
      background: #e0e0e0;
      color: #333;
      font-size: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      border: 2px dashed var(--border);
    }

    #imagenInput {
      display: none;
    }

    .canvas-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    #canvas-controls {
      position: absolute;
      left: 10px;
      top: 10px;
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
    }

    #colorFondoCanvas {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      border: 2px solid var(--border);
      background: #fff;
      cursor: pointer;
      margin-bottom: 4px;
    }

    #flyerCanvas {
      border: 2px solid var(--border);
      border-radius: 8px;
      background: white;
    }

    .top-bar {
      position: fixed;
      top: 10px;
      left: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 100;
    }

    .toggle-dark {
      cursor: pointer;
      font-size: 24px;
    }

    .download-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .download-buttons button {
      flex: 1;
    }

    /* Footer */
    .footer-banner {
      background: var(--footer-bg);
      color: var(--footer-text);
      text-align: left;
      padding: 14px 10px 12px 10px;
      font-size: 0.98rem;
      letter-spacing: 1px;
      border-radius: 12px 12px 0 0;
      margin-top: 34px;
      font-family: 'Montserrat', Arial, sans-serif;
      box-shadow: 0 -2px 16px rgba(0,0,0,0.07);
      width: 100%;
    }
  </style>
</head>
<body class="light">

  <div class="header-banner">
    <strong>🎨 ¡Crea tu flyer en segundos!</strong>
    <span>Agregá textos, imágenes, QR y descargá en JPG o PDF.<br/>Elegí fuente y colores, todo visual. Mirá cómo funciona en este 
      <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank" rel="noopener">video tutorial</a> 📹
    </span>
  </div>

  <div class="main-content">
    <div class="top-bar">
      <div class="toggle-dark" id="toggleDark" title="Modo claro/oscuro">🌞</div>
    </div>

    <div class="panel">
      <label for="titulo">Título</label>
      <input type="text" id="titulo" placeholder="Texto..." />

      <label for="fuente">Fuente</label>
      <select id="fuente">
        <option value="Arial">Arial</option>
        <option value="Bebas Neue">Bebas Neue</option>
        <option value="Montserrat">Montserrat</option>
        <option value="Anton">Anton</option>
        <option value="Oswald">Oswald</option>
        <option value="Poppins">Poppins</option>
        <option value="Playfair Display">Playfair Display</option>
        <option value="Lobster">Lobster</option>
        <option value="Archivo Black">Archivo Black</option>
        <option value="Abril Fatface">Abril Fatface</option>
        <option value="Quicksand">Quicksand</option>
        <!-- Alternativas graffiti y caligráficas -->
        <option value="Arizonia">Arizonia</option>
        <option value="Permanent Marker">Permanent Marker (graffiti)</option>
        <option value="Rock Salt">Rock Salt (graffiti)</option>
        <option value="Fredericka the Great">Fredericka the Great (brush)</option>
        <option value="Bangers">Bangers (comic/graffiti)</option>
        <option value="Covered By Your Grace">Covered By Your Grace (urbana)</option>
        <option value="Luckiest Guy">Luckiest Guy (bold graffiti)</option>
        <option value="Shadows Into Light">Shadows Into Light (rotulador)</option>
        <option value="Orbitron">Orbitron (techno/futurista)</option>
        <!-- 20 fuentes creativas extra -->
        <option value="Indie Flower">Indie Flower (informal, amigable)</option>
        <option value="Pacifico">Pacifico (cursiva retro)</option>
        <option value="Press Start 2P">Press Start 2P (pixel/gamer)</option>
        <option value="Gloria Hallelujah">Gloria Hallelujah (handwriting)</option>
        <option value="Rammetto One">Rammetto One (gruesa, moderna)</option>
        <option value="Monoton">Monoton (neón disco)</option>
        <option value="Rubik Moonrocks">Rubik Moonrocks (abstracta)</option>
        <option value="Special Elite">Special Elite (máquina de escribir)</option>
        <option value="Amatic SC">Amatic SC (titulares, manuscrita)</option>
        <option value="VT323">VT323 (terminal retro)</option>
        <option value="Chewy">Chewy (divertida, redondeada)</option>
        <option value="Black Ops One">Black Ops One (militar, fuerte)</option>
        <option value="Faster One">Faster One (velocidad, deporte)</option>
        <option value="Acme">Acme (amistosa, universal)</option>
        <option value="Rye">Rye (western)</option>
        <option value="Rubik 80s Fade">Rubik 80s Fade (vaporwave/80s)</option>
        <option value="Sigmar One">Sigmar One (grande, fuerte)</option>
        <option value="UnifrakturCook">UnifrakturCook (gótica)</option>
        <option value="Sacramento">Sacramento (caligráfica elegante)</option>
        <option value="Chango">Chango (divertida, impactante)</option>
        <option value="Major Mono Display">Major Mono Display (monoespaciada creativa)</option>
        <option value="IBM Plex Mono">IBM Plex Mono (tech, monoespaciada)</option>
        <option value="Poiret One">Poiret One (art déco)</option>
        <option value="Unbounded">Unbounded (moderna, redondeada)</option>
        <!-- Webdings -->
        <option value="Webdings">Webdings (símbolos)</option>
      </select>

      <div class="color-row">
        <label for="colorTexto" style="margin-bottom:0;">Color del texto</label>
        <div class="color-wrap" style="margin-left:auto;">
          <span class="color-square" id="colorTextoSquare"></span>
          <input type="color" id="colorTexto" value="#000000" tabindex="-1">
        </div>
      </div>

      <button id="btnAgregarTexto">Agregar texto</button>

      <div class="layer-controls">
        <button id="btnSubirCapa">↑</button>
        <button id="btnBajarCapa">↓</button>
        <button id="btnEliminar">🗑</button>
      </div>

      <label for="imagenInput" class="upload-box" title="Subir imagen">+</label>
      <input type="file" id="imagenInput" accept="image/*" multiple>

      <label for="telefono">WhatsApp Uruguay</label>
      <input type="text" id="telefono" placeholder="Ej: 094123456" />
      <button id="btnGenerarQR">Generar QR</button>

      <div class="download-buttons">
        <button id="btnDescargarJPG">Descargar JPG</button>
        <button id="btnDescargarPDF">Descargar PDF</button>
      </div>
    </div>

    <div class="canvas-container">
      <div id="canvas-controls">
        <label for="colorFondoCanvas" style="font-size:13px;margin-bottom:3px;">Fondo flyer</label>
        <input type="color" id="colorFondoCanvas" title="Color de fondo del flyer" />
      </div>
      <canvas id="flyerCanvas" width="600" height="800"></canvas>
    </div>
  </div>

  <div class="footer-banner">
    Derechos reservados &copy; OtroMundo 2025
  </div>

<script>
  const canvas = new fabric.Canvas("flyerCanvas", {
    preserveObjectStacking: true
  });

  // Fondo blanco por defecto
  canvas.setBackgroundColor("white", canvas.renderAll.bind(canvas));
  document.getElementById("colorFondoCanvas").value = "#ffffff";

  // Modo claro/oscuro
  const toggleDark = document.getElementById("toggleDark");
  toggleDark.onclick = () => {
    document.body.classList.toggle("dark");
    toggleDark.textContent = document.body.classList.contains("dark") ? "🌙" : "🌞";
  };

  // Cambiar color de fondo del canvas
  const fondoPicker = document.getElementById("colorFondoCanvas");
  fondoPicker.addEventListener("change", () => {
    canvas.setBackgroundColor(fondoPicker.value, canvas.renderAll.bind(canvas));
  });

  // Reflejar el color del texto en el cuadrado
  const colorInput = document.getElementById("colorTexto");
  const colorSquare = document.getElementById("colorTextoSquare");
  function updateColorSquare() {
    colorSquare.style.background = colorInput.value;
  }
  colorInput.addEventListener("input", updateColorSquare);
  // Permite hacer click en el cuadrado para abrir el selector
  colorSquare.onclick = () => colorInput.click();
  updateColorSquare();

  // Agregar texto
  document.getElementById("btnAgregarTexto").onclick = () => {
    const texto = document.getElementById("titulo").value;
    if (!texto.trim()) return alert("Ingresá texto.");
    let font = document.getElementById("fuente").value;
    const color = colorInput.value;
    if (font === "Webdings") font = "Webdings";
    const obj = new fabric.Textbox(texto, {
      left: canvas.width / 2,
      top: canvas.height / 2,
      fontSize: 24,
      fill: color,
      fontFamily: font,
      originX: "center",
      originY: "center",
    });
    canvas.add(obj);
    canvas.setActiveObject(obj);
    canvas.renderAll();
  };

  // Actualizar fuente en tiempo real
  document.getElementById("fuente").onchange = () => {
    const active = canvas.getActiveObject();
    if (active && active.type === "textbox") {
      let font = document.getElementById("fuente").value;
      if (font === "Webdings") font = "Webdings";
      active.set("fontFamily", font);
      canvas.renderAll();
    }
  };

  // Actualizar color en tiempo real
  colorInput.onchange = () => {
    updateColorSquare();
    const active = canvas.getActiveObject();
    if (active && active.type === "textbox") {
      active.set("fill", colorInput.value);
      canvas.renderAll();
    }
  };

  // Subir capa
  document.getElementById("btnSubirCapa").onclick = () => {
    const obj = canvas.getActiveObject();
    if (obj) canvas.bringForward(obj);
  };

  // Bajar capa
  document.getElementById("btnBajarCapa").onclick = () => {
    const obj = canvas.getActiveObject();
    if (obj) canvas.sendBackwards(obj);
  };

  // Eliminar objeto
  document.getElementById("btnEliminar").onclick = () => {
    const obj = canvas.getActiveObject();
    if (obj) canvas.remove(obj);
  };

  // Agregar imagen
  document.getElementById("imagenInput").addEventListener("change", (e) => {
    const files = e.target.files;
    [...files].forEach((file) => {
      const reader = new FileReader();
      reader.onload = (event) => {
        fabric.Image.fromURL(event.target.result, (img) => {
          img.scaleToWidth(250);
          img.set({
            left: canvas.width / 2,
            top: canvas.height / 2,
            originX: "center",
            originY: "center",
          });
          canvas.add(img);
          canvas.renderAll();
        });
      };
      reader.readAsDataURL(file);
    });
  });

  // Generar QR
  document.getElementById("btnGenerarQR").onclick = () => {
    const tel = document.getElementById("telefono").value.trim();
    if (!tel.match(/^\d{6,}$/)) return alert("Número inválido");
    const url = `https://wa.me/598${tel}?text=Hola!%20vi%20tu%20flyer`;
    const qr = new QRious({ value: url, size: 300 });
    fabric.Image.fromURL(qr.toDataURL(), (img) => {
      img.scaleToWidth(150);
      img.set({
        left: canvas.width / 2,
        top: canvas.height / 2,
        originX: "center",
        originY: "center",
      });
      canvas.add(img);
      canvas.renderAll();
    });
  };

  // Descargar JPG
  document.getElementById("btnDescargarJPG").onclick = () => {
    const url = canvas.toDataURL({ format: "jpeg", quality: 0.95 });
    const link = document.createElement("a");
    link.href = url;
    link.download = "flyer.jpg";
    link.click();
  };

  // Descargar PDF
  document.getElementById("btnDescargarPDF").onclick = async () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({
      orientation: "portrait",
      unit: "px",
      format: [canvas.width, canvas.height],
    });
    const dataURL = canvas.toDataURL({ format: "jpeg", quality: 1.0 });
    pdf.addImage(dataURL, "JPEG", 0, 0, canvas.width, canvas.height);
    pdf.save("flyer.pdf");
  };
</script>

</body>
</html>